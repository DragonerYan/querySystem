import{a0 as t,y as e,o as a,c as o,w as s,a as i,b as l,G as c,f as n,A as d,F as r,p as h,k as p,i as u,U as m,ae as k,q as f,B as g,r as y,g as w,z as $,s as M}from"./index-93422e90.js";import{_ as C,o as _}from"./uni-app.es.1373d43e.js";const b=C({props:{color:{type:String,default:"#ff6000"},keyMap:{type:String,default:"1780b36335e4fa508c898378a18674ef"},AMapKeyWeb:{type:String,default:"8d73f322493bde9ad4480d2cc83e69bb"},initLocation:{type:String,default:""},show:{type:Boolean,default:!1},val:{type:String,default:""}},data:()=>({list:[],keyword:"",timeId:null,checked:{locaiton:""},locations:"",showPlace:!1}),mounted(){this.keyword=this.val,this.showPlace=this.show;var t=document.getElementById("mapTest");let e=this;var a;this.locations=this.initLocation,t?this.loop():((a=document.createElement("script")).type="text/javascript",a.setAttribute("id","mapTest"),a.src=`https://webapi.amap.com/maps?v=2.0&key=${e.keyMap}`,document.body.appendChild(a),e.loop())},watch:{show(t,e){this.showPlace=t,this.$nextTick((()=>{this.loop()}))}},methods:{loop(){try{this.initMapWeb()}catch(t){setTimeout((()=>this.loop()),200)}},inputValue(t){this.timeId&&clearTimeout(this.timeId),this.timeId=setTimeout((()=>{this.getPlaces(t.detail.value,""),this.timeId=null}))},cancel(){this.keyword="",this.list=[],this.maker&&this.marker.setMap(null)},toCancel(){this.showPlace=!1,this.cancel(),this.$emit("changeShow",!1)},confrom(){if(this.checked){let t;t=this.checked.addressLocal?this.checked.addressLocal:`${this.checked.district}${this.checked.address?"-"+this.checked.address:""}`;let e=this.checked.location.split(",");this.$emit("placeChoose",{address:t,adcode:this.checked.adcode,latitude:e[1],longitude:e[0]}),this.showPlace=!1,this.cancel()}},toChecked(t){if(this.checked=t,this.marker){this.marker.setMap(null);let e=t.location.split(",");this.addMarker(e[0],e[1])}},initMapWeb(){let t=this;if(this.map=new AMap.Map("map",{center:["106.55","29.57"],zoom:16}),this.map.on("click",(e=>{this.marker&&this.marker.setMap(null),t.addMarker(e.lnglat.lng,e.lnglat.lat),this.locations=`${e.lnglat.lng}, ${e.lnglat.lat}`,t.getPlaces("",`${e.lnglat.lng}, ${e.lnglat.lat}`),t.getNowPlace(`${e.lnglat.lng}, ${e.lnglat.lat}`)})),this.initLocation.length>0){let e=this.initLocation.split(",");return t.addMarker(e[0],e[1]),this.locations=`${e[0]}, ${e[1]}`,t.getPlaces("",`${e[0]}, ${e[1]}`),void t.getNowPlace(`${e[0]}, ${e[1]}`)}AMap.plugin("AMap.Geolocation",(function(){new AMap.Geolocation({enableHighAccuracy:!0,timeout:1e4,buttonOffset:new AMap.Pixel(10,20),zoomToAccuracy:!0,buttonPosition:"RB"}).getCurrentPosition((function(e,a){"SUCCESS"==a.info&&a.position&&a.position&&(t.addMarker(a.position.lng,a.position.lat),t.getPlaces("",`${a.position.lng}, ${a.position.lat}`),t.getNowPlace(`${a.position.lng}, ${a.position.lat}`))}))}))},getNowPlace(a){t({url:`https://restapi.amap.com/v3/geocode/regeo?key=${this.AMapKeyWeb}&location=${a}`,method:"GET",success:t=>{let e=t.data;if("1"==e.status){let t=e.regeocode;this.checked={adcode:t.addressComponent.adcode,city:t.addressComponent.city,district:t.addressComponent.district,location:a,addressLocal:t.formatted_address}}},fail:t=>{e({title:JSON.stringify(t),icon:"none"})}})},addMarker(t,e){var a=new AMap.Icon({image:"//a.amap.com/jsapi_demos/static/demo-center/icons/poi-marker-default.png",imageSize:new AMap.Size(32,42)});this.marker=new AMap.Marker({icon:a,position:[t,e]}),this.marker.setMap(this.map),this.map.setCenter([t,e])},getPlaces(a,o){const s=`https://restapi.amap.com/v3/assistant/inputtips?key=${this.AMapKeyWeb}&keywords=${this.keyword}&location=${this.locations}`;t({url:s,method:"GET",success:t=>{console.log(t,66666666,s);let e=t.data;"1"===e.status&&(this.list=e.tips.filter((t=>t.location&&t.location.length>0)))},fail:t=>{e({title:JSON.stringify(t),icon:"none"})}})}}},[["render",function(t,e,y,w,$,M){const C=p,_=u,b=m,v=k;return $.showPlace?(a(),o(_,{key:0,class:"amap-choose"},{default:s((()=>[i(_,{class:"top-button"},{default:s((()=>[i(C,{class:"cancel",onClick:M.toCancel},{default:s((()=>[l("取消")])),_:1},8,["onClick"]),i(C,{class:"conform",style:c({backgroundColor:y.color}),onClick:M.confrom},{default:s((()=>[l("完成")])),_:1},8,["style","onClick"])])),_:1}),i(_,{class:"map-box"},{default:s((()=>[i(_,{id:"map"})])),_:1}),i(_,{class:"content"},{default:s((()=>[i(_,{class:"search"},{default:s((()=>[i(_,null,{default:s((()=>[i(b,{src:"/assets/search-99d0cdcd.png"}),i(v,{placeholder:"搜索地点",onInput:M.inputValue,modelValue:$.keyword,"onUpdate:modelValue":e[0]||(e[0]=t=>$.keyword=t)},null,8,["onInput","modelValue"])])),_:1}),i(C,{onClick:M.cancel},{default:s((()=>[l("取消")])),_:1},8,["onClick"])])),_:1}),i(_,{class:"main"},{default:s((()=>[(a(!0),n(r,null,d($.list,((t,e)=>(a(),o(_,{key:e,onClick:e=>M.toChecked(t)},{default:s((()=>[i(_,{class:f({active:t.location===$.checked.location})},{default:s((()=>[i(_,null,{default:s((()=>[l(g(t.name),1)])),_:2},1024),i(C,{class:"detail"},{default:s((()=>[l(g(t.district)+g(t.address?"-"+t.address:""),1)])),_:2},1024)])),_:2},1032,["class"]),i(_,null,{default:s((()=>[t.location===$.checked.location?(a(),o(C,{key:0,style:c({color:y.color})},{default:s((()=>[l("√")])),_:1},8,["style"])):h("",!0)])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1})])),_:1})):h("",!0)}],["__scopeId","data-v-711b5b7e"]]),v={__name:"map",props:{keyword:String},setup(t){const e=y(""),s=y(null);_((t=>{e.value=t.keyword||"",s.value=t.key}));const i=w("userInfo")||{},l=i.latitude||"",c=i.longitude||"",n=y(c?c+","+l:""),d=t=>{$();const e=w("location")||{};e[s.value]=t,M("location",e)},r=t=>{$(),console.log(t,"选中显示")};return(t,s)=>(a(),o(b,{show:"",color:"#3c9cff",initLocation:n.value,val:e.value,onPlaceChoose:d,onChangeShow:r},null,8,["initLocation","val"]))}};export{v as default};
