import{n as h,v as n,i as g,j as v,V as _,k as y,p as b,m as C,l as w,o as D,q as S,r as O,t as I}from"./index-8ae2a273.js";import{m as x,A as c,a as k,r as A,h as l,T,b as V}from"./Audit-6c8b117d.js";var B=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"detail-base"},[e("div",{staticClass:"audit-status"},[t.state==t.areaStateOptions[0].value?e("t-tag",{attrs:{size:"large",theme:"warning",variant:"light"}},[t._v(t._s(t.areaStateOptions[0].label))]):t.state==t.areaStateOptions[1].value?e("t-tag",{attrs:{size:"large",theme:"success",variant:"light"}},[t._v(t._s(t.areaStateOptions[1].label))]):t.state==t.areaStateOptions[2].value?e("t-tag",{attrs:{size:"large",theme:"danger",variant:"light"}},[t._v(t._s(t.areaStateOptions[2].label))]):t._e(),t.state==t.areaStateOptions[2].value?e("p",{staticClass:"reason"},[e("span",[t._v("拒绝理由：")]),e("span",[t._v(" "+t._s(t.formData.reviewComment))])]):t._e()],1),t._l(t.baseInfoData,function(s,i){return e("t-card",{key:i,attrs:{title:s.title,bordered:!1}},[e("div",{staticClass:"info-block",class:{"info-block-row":i>1}},t._l(s.children,function(o){return e("div",{key:o.prop,staticClass:"info-item"},[e("p",{staticClass:"label"},[e("span",[t._v(t._s(o.name))]),e("span",{staticClass:"value"},[t._v(" "+t._s(t.formData[o.prop]))]),t._v(t._s(o.value))])])}),0)])})],2)},$=[];const K={name:"CityDetail",props:{detail:{type:Object,default:()=>({})}},data(){return{baseInfoData:x.getInfoData(),formData:{state:""},areaStateOptions:c}},created(){this.init()},computed:{state(){return this.formData.state}},methods:{init(){const t=this.detail;for(const a in t){let e=t[a];switch(a){case"communityId":e=g(t);break;case"courtType":e=t[a]==l[l.length-1].value?t.courtTypeOther:n(l,t[a]);break;case"remodel":e=n(A,t[a]);break;case"management":e=n(k,t[a]);break}this.formData[a]=e}}}},u={};var N=h(K,B,$,!1,F,"1d7869b8",null,null);function F(t){for(let a in u)this[a]=u[a]}const P=function(){return N.exports}(),j=()=>({province:"",city:"",state:"",reviewComment:"",county:"",street:"",courtName:"",communityId:"",communityName:"",courtType:[],courtTypeOther:"",buildTime:"",remodel:"",management:"",area:"",dateTime:"",numberDepartment:"",numberPeople:"",numberOver60People:"",numberBuilding:"",number13Building:"",number46Building:"",number79Building:"",numberOver10Building:"",reportYear:""}),z=()=>({"2.1":"","2.1.1":"","2.1.2":"","2.1.3":"","2.1.4":"","2.2":"","2.3":"","2.3.1":"","2.3.2":"","2.3.3":"","2.3.4":"","2.3.5":"","2.3.6":"","2.3.7":"","2.4":"","2.4.1":"","2.4.2":"","2.4.3":"","2.4.4":"","2.4.5":"","2.5":"","2.5.1":"","2.5.2":"","2.6":"","2.6.1":"","2.6.2":"","2.6.3":"","2.7":"","2.7.1":"","2.7.2":"","2.8":"","2.8.1":"","2.8.2":"","2.8.3":"","2.8.4":"","2.9":"","2.10":"","2.10.1":"","2.10.2":"","2.10.3":"","2.10.4":""}),m=({basicInfo:t,indicatorValueList:a},e)=>{const s=e;t=v(t),a.forEach(i=>{Object.hasOwnProperty.call(s,i.indicatorId)&&(s[i.indicatorId]=i.indicatorValue)});for(let i in t)Object.hasOwnProperty.call(s,i)&&(s[i]=t[i]);return s},R=[{colKey:"row-select",type:"multiple",width:64,fixed:"left"},{title:"小区",colKey:"courtName"},{title:"省",colKey:"province"},{title:"市",colKey:"city"},{title:"区",colKey:"county"},{title:"街道",colKey:"street",width:200},{title:"社区",colKey:"communityName"},{title:"状态",cell:{col:"state"},colKey:"state"},{align:"left",fixed:"right",colKey:"op",title:"操作",width:120}];var E=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",[e("t-card",{staticClass:"list-card-container",attrs:{bordered:!1}},[e("t-form",{ref:"form",style:{marginBottom:"8px"},attrs:{data:t.formData,"label-width":"fit-content",colon:""},on:{reset:t.onReset,submit:t.onSubmit}},[e("t-row",{attrs:{justify:"space-between"}},[e("t-col",{attrs:{span:6}},[e("t-row",{staticStyle:{"flex-wrap":"nowrap"}},[e("t-col",{attrs:{flex:5}},[e("t-form-item",{attrs:{label:"省市区街道社区"}},[e("t-cascader",{attrs:{options:t.options,placeholder:"请选择市区街道","check-strictly":""},on:{change:t.handleChange},model:{value:t.areaVal,callback:function(s){t.areaVal=s},expression:"areaVal"}})],1)],1),e("t-col",{attrs:{flex:4,offset:1}},[e("t-form-item",{attrs:{label:"审核状态",name:"state"}},[e("t-select",{staticClass:"form-item-content`",attrs:{options:t.areaStateOptions,placeholder:"请选择合同状态"},model:{value:t.formData.state,callback:function(s){t.$set(t.formData,"state",s)},expression:"formData.state"}})],1)],1)],1)],1),e("t-col",{staticClass:"operation-container",attrs:{span:2}},[e("t-button",{style:{marginLeft:"8px"},attrs:{theme:"primary",type:"submit"}},[t._v(" 查询 ")]),e("t-button",{attrs:{type:"reset",variant:"base",theme:"default"}},[t._v(" 重置 ")])],1)],1)],1),e("div",{staticClass:"table-container"},[e("t-table",{attrs:{columns:t.columns,data:t.data,rowKey:t.rowKey,verticalAlign:t.verticalAlign,hover:t.hover,pagination:t.pagination,"selected-row-keys":t.selectedRowKeys,loading:t.dataLoading,stripe:"",bordered:"",headerAffixedTop:!0,headerAffixProps:{offsetTop:t.offsetTop,container:t.getContainer}},on:{"page-change":t.rehandlePageChange,change:t.rehandleChange,"select-change":t.rehandleSelectChange},scopedSlots:t._u([{key:"state",fn:function(s){var i=s.row;return[i.state==t.areaStateOptions[0].value?e("t-tag",{attrs:{theme:"warning",variant:"light"}},[t._v(t._s(t.areaStateOptions[0].label))]):i.state==t.areaStateOptions[1].value?e("t-tag",{attrs:{theme:"success",variant:"light"}},[t._v(t._s(t.areaStateOptions[1].label))]):i.state==t.areaStateOptions[2].value?e("t-tag",{attrs:{theme:"danger",variant:"light"}},[t._v(t._s(t.areaStateOptions[2].label))]):t._e()]}},{key:"op",fn:function(s){var i=s.row;return[e("a",{staticClass:"t-button-link",on:{click:function(o){return t.handleClickDetail(i)}}},[t._v(t._s(i.state!=t.areaStateOptions[0].value?"详情":"审核"))])]}}])})],1)],1),e("t-drawer",{class:{loading:t.loading},attrs:{size:"66vw",confirmBtn:{content:t.isAudit?"审核":"确定"},visible:t.drawerVisible,onConfirm:t.handleConfirm,header:t.detailTitle},on:{close:t.handleClose}},[t.loading?e("t-loading"):e("CityDetail",{ref:"detailRef",attrs:{detail:Object.assign({},t.examForm,t.baseForm)}})],1),e("t-dialog",{attrs:{header:t.auditTitle,visible:t.auditVisible,destroyOnClose:""},on:{"update:visible":function(s){t.auditVisible=s},confirm:t.handleAudit}},[e("Audit",{ref:"audit"})],1)],1)},L=[];const r={city:"",communityId:"",communityName:"",county:"",indicatorId:"",isPc:1,offset:1,pageSize:10,province:"",state:"",street:""},q=_.extend({name:"ListBase",components:{SearchIcon:y,Trend:T,CityDetail:P,Audit:V},data(){return{prefix:b,dataLoading:!1,data:[],selectedRowKeys:[1,2],columns:R,rowKey:"pid",verticalAlign:"top",hover:!0,areaVal:"",rowClassName:t=>`${t}-class`,pagination:{defaultPageSize:20,total:0,defaultCurrent:1},searchValue:"",auditVisible:!1,deleteIdx:-1,drawerVisible:!1,formData:{...r},options:[],areaStateOptions:c,auditTitle:"",loading:!1,baseForm:{},detailTitle:"",examForm:{}}},computed:{isAudit(){var t;return((t=this.baseForm)==null?void 0:t.state)==c[0].value},...C("user",["personInfo"]),offsetTop(){return this.$store.state.setting.isUseTabsRouter?48:0}},created(){this.init()},methods:{init(){const t=w.cloneDeep(this.personInfo);for(let a in r){if(Object.hasOwnProperty.call(t,a)){const e=this.personInfo[a];r[a]=e=="-"?"":e}this.formData[a]=r[a]}D(t.children),this.options=t.children.children,this.getAllCourtBasicInfo()},async getAllCourtBasicInfo(){const t={...this.formData};for(const s in t)t[s]===""&&delete t[s];this.dataLoading=!0,this.pagination.defaultCurrent=t.offset,this.pagination.defaultPageSize=t.pageSize;const a=await S(t);this.dataLoading=!1;const e=a.data;e.status=="0"?(this.pagination.total=e.data.total,t.offset==r.offset?this.data=e.data.records:this.data=[...this.data,...e.data.records]):this.$message.warning(a.data.msg),this.data.forEach((s,i)=>{s.pid=s.courtName+"_"+i})},handleChange(t,a){var s;const e=(s=a.node)==null?void 0:s.getPath();this.formData.province=r.province,this.formData.city=r.city,this.formData.county=r.county,this.formData.street=r.street,this.formData.communityId=r.communityId,this.formData.communityName=r.communityName,e.forEach(i=>{const{prop:o,value:p,label:d}=i.data;switch(this.formData[o]=p,o){case"communityId":this.formData.communityName=d;break;case"street":this.formData[o]=d;break}})},onReset(){this.formData={...r},this.areaVal="",this.getAllCourtBasicInfo()},onSubmit(){this.formData.offset=r.offset,this.getAllCourtBasicInfo()},getContainer(){return document.querySelector(".tdesign-starter-layout")},rehandlePageChange(t,a){this.formData.pageSize=t.pageSize,this.formData.offset=t.current},rehandleSelectChange(t){this.selectedRowKeys=t},rehandleChange(t,a){this.getAllCourtBasicInfo(),console.log("统一Change",t,a)},async handleClickDetail(t){this.loading=!0,this.drawerVisible=!this.drawerVisible,this.detailTitle=t.courtName+"填报情况";const a={communityId:t.communityId,courtName:t.courtName},e=await O(a);e.data.status=="0"&&(this.examForm=m(e.data.data,z()),this.baseForm=m(e.data.data,j()),this.loading=!1)},handleClose(){this.drawerVisible=!this.drawerVisible},handleConfirm(){var t;if(!this.isAudit)return this.handleClose();this.auditTitle=(((t=this.baseForm)==null?void 0:t.courtName)||"")+"审核",this.auditVisible=!0},async handleAudit(){const t=await this.$refs.audit.validate(),a=Object.assign(this.baseForm,t);(await I(a)).data.status=="0"&&(this.baseForm=Object.assign(this.baseForm,t),this.auditVisible=!1,this.$refs.detailRef.init(),this.$message.success("审核成功"),this.getAllCourtBasicInfo())}}}),f={};var M=h(q,E,L,!1,U,"214cde3a",null,null);function U(t){for(let a in f)this[a]=f[a]}const H=function(){return M.exports}();export{H as default};
