<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.atv.notgenerator.dao.mapper.AuditService">
    <select id="test" resultType="map">
        show
        tables
    </select>

    <select id="login" resultType="String" parameterType="map">
        select
        password
        from
        SMOKE.User as User
        where
        user = #{userName}
    </select>

    <select id="smokeInquiry" resultType="map" parameterType="map">
        select
        id, name, num, is_sale, height, width
        from
        SMOKE.Smoke as Smoke
        <where>
            <if test="smokeName !=null and smokeName != ''">
                name = #{smokeName}
            </if>
        </where>
    </select>

    <select id="smokeInquirySales" resultType="map" parameterType="map">
        select
        Smoke.height, Smoke.width, sum(Sale.sale_num) as sale_num, Smoke.name, City.city_name
        from
        SMOKE.Sale as Sale, SMOKE.Smoke as Smoke, SMOKE.City as City
        where
        Sale.city_id = City.city_id
        and
        Sale.id = Smoke.id
        <if test="smokeName !=null and smokeName != ''">
            and  Smoke.name = #{smokeName}
        </if>
        group by
        City.city_name, Smoke.name, Smoke.height, Smoke.width
    </select>

    <select id="smokeInquirySalesByCity" resultType="map" parameterType="map">
        select
        Smoke.name,Smoke.width,Smoke.height, sum(Sale.sale_num) as sale_num
        from
        SMOKE.Sale as Sale, SMOKE.City as City, SMOKE.Smoke as Smoke
        where
        City.city_id = Sale.city_id
        and
        Sale.id = Smoke.id
        <if test="date !=null and date != ''">
            and  Sale.day = #{date}
        </if>
        and
        City.city_name = #{cityName}
        group by
        Smoke.name, Smoke.width, Smoke.height
        order by sale_num desc
    </select>

    <select id="insertIntoSale" parameterType="map">
        insert into SMOKE.Sale
        (id, sale_num, day, shop_id)
        values
        (#{id},
        #{sale_num},
        #{day},
        #{shop_id})
    </select>

    <select id="insertIntoSmoke" parameterType="map">
        insert into SMOKE.Smoke
        (id, name, num, is_sale, height, width)
        values
        (#{id},
        #{name},
        #{num},
        #{is_sale},
        #{height},
        #{width})
    </select>

    <select id="insertIntoShop" parameterType="map">
        insert into SMOKE.Shop
        (shop_id, shop_name, owner_name, tel, city_id)
        values
        (#{shop_id},
        #{shop_name},
        #{owner_name},
        #{tel},
        #{city_id})
    </select>

    <select id="inquiryAllSaleByCity" resultType="map">
        select
        sum(Sale.sale_num) as sale_num,
        City.city_name
        from SMOKE.Sale as Sale, SMOKE.Shop as Shop, SMOKE.City as City
        where
        Sale.shop_id=Shop.shop_id
        and
        Shop.city_id=City.city_id
        group by
        City.city_name
        order by
        sale_num desc
    </select>

    <select id="loginRecord" parameterType="map">
        insert into SMOKE.Record
        (userName, date, location, isAbnormal)
        values
        (#{userName}, #{date}, #{location}, #{isAbnormal})
    </select>

    <select id="inquiryLoginRecord" resultType="map">
        select
        userName, date, location, isAbnormal
        from
        SMOKE.Record
    </select>

    <select id="inquirySaleOrderByDay" resultType="map">
        select  sum(Sale.sale_num) as sale_num, Sale.day
        from
        SMOKE.Sale as Sale, SMOKE.Smoke as Smoke
        where
        Sale.id=Smoke.id
        group by
        Sale.day
        order by
        Sale.day
    </select>

    <select id="inquiryId" resultType="int">
        select
        max(CONVERT(id,UNSIGNED)+1)
        from
        SMOKE.Smoke
    </select>

    <select id="inquirySmokeId" resultType="String" parameterType="map">
        select
        id
        from
        SMOKE.Smoke as Smoke
        where
        name = #{name}
    </select>

    <select id="inquiryShopId" resultType="String" parameterType="map">
        select
        shop_id
        from
        SMOKE.Shop as Shop
        where
        shop_name = #{shop_name}
    </select>

    <select id="inquiryMaxShopId" resultType="map">
        select
        max(CONVERT(shop_id,UNSIGNED)+1) as maxId
        from
        SMOKE.Shop as Shop
    </select>

    <select id="inquiryCityId" resultType="String" parameterType="map">
        select
        city_id
        from
        SMOKE.City as City
        where
        city_name = #{city_name}
    </select>
</mapper>